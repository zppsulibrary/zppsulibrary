<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="index.css">
    <script src="script.js" defer></script>
    <title>ZPPSU LIBRARY Registration Form</title>
</head>
<body>
    <div class="container">
        <div class="title">ZPPSU LIBRARY Registration Form</div>
        <form action="#" method="post">
            <label for="lastname">Name:</label>
            <div class="name-group">
                <input type="text" id="lastname" name="lastname" placeholder="Lastname" required>
                <input type="text" id="givenname" name="givenname" placeholder="Givenname" required>
                <input type="text" id="mi" name="mi" placeholder="MI" maxlength="1" required>
            </div>
            <label for="program">Program:</label>
            <select id="program" name="program" onchange="updateCourses()" required>
                <option value="">-- Select Program --</option>
                <option value="CAT">CAT</option>
                <option value="CTE">CTE</option>
                <option value="CICS">CICS</option>
            </select>
            
            <select id="course" name="course" required>
                <option value="">-- Select Course --</option>
            </select>
            
            <select id="major" name="major">
                <option value="">-- Select Major --</option>
            </select>            
            <label for="patron-type">Type of Patrons:</label>
            <select id="patron-type" name="patron-type" required>
                <option value="">-- Select Patrons --</option>
                <option value="student">Student</option>
                <option value="faculty">Faculty</option>
                <option value="adviser">Adviser</option>
                <option value="visitor">Visitor</option>
            </select>
            <label for="school-year">School Year:</label>
            <select id="school-year" name="school-year" required>
                <option value="">-- Select School Year --</option>
                <option value="2024-2025">2024-2025</option>
                <option value="2026-2027">2026-2027</option>
            </select>
            <label for="semester">Semester:</label>
            <select id="semester" name="semester" required>
                <option value="">-- Select Semester --</option>
                <option value="1st">1st</option>
                <option value="2nd">2nd</option>
            </select>
            <button type="submit" class="submit-button">Submit</button>
        </form>
        
    </div>
</body>
<script>
    // Your web app's Firebase configuration
    const firebaseConfig = {
  apiKey: "AIzaSyAATH_41xPWHK7FWORsbKvFZNjgN0nwzS8",
  authDomain: "zppsulibrary-3f15b.firebaseapp.com",
  projectId: "zppsulibrary-3f15b",
  storageBucket: "zppsulibrary-3f15b.firebasestorage.app",
  messagingSenderId: "693170608073",
  appId: "1:693170608073:web:5a92d9c695a10bc975fa18"
};

// Initialize Firebase
const app = firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// Function to update courses based on selected program
function updateCourses() {
    const program = document.getElementById('program').value;
    const courseSelect = document.getElementById('course');
    const majorSelect = document.getElementById('major');

    // Clear previous options
    courseSelect.innerHTML = '<option value="">-- Select Course --</option>';
    majorSelect.innerHTML = '<option value="">-- Select Major --</option>';

    if (program === 'CAT') {
        courseSelect.innerHTML += '<option value="BSIT">BSIT</option>';
        majorSelect.innerHTML += '<option value="Web Development">Web Development</option>';
    } else if (program === 'CTE') {
        courseSelect.innerHTML += '<option value="BSEd">BSEd</option>';
        majorSelect.innerHTML += '<option value="Math">Math</option>';
    } else if (program === 'CICS') {
        courseSelect.innerHTML += '<option value="BSCS">BSCS</option>';
        majorSelect.innerHTML += '<option value="Data Science">Data Science</option>';
    }
}

// Handle form submission
document.querySelector('form').addEventListener('submit', function(event) {
    event.preventDefault(); // Prevent the form from submitting the traditional way

    // Sign in anonymously
    firebase.auth().signInAnonymously()
    .then(() => {
        // Get form values
        const lastname = document.getElementById('lastname').value;
        const givenname = document.getElementById('givenname').value;
        const mi = document.getElementById('mi').value;
        const program = document.getElementById('program').value;
        const course = document.getElementById('course').value;
        const major = document.getElementById('major').value;
        const patronType = document.getElementById('patron-type').value;
        const schoolYear = document.getElementById('school-year').value;
        const semester = document.getElementById('semester').value;

        // Add a new document to the "registrations" collection
        return db.collection('registrations').add({
            lastname: lastname,
            givenname: givenname,
            mi: mi,
            program: program,
            course: course,
            major: major,
            patronType: patronType,
            schoolYear: schoolYear,
            semester: semester,
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
        });
    })
    .then(() => {
        alert('Registration successful!');
        // Optionally, reset the form
        document.querySelector('form').reset();
    })
    .catch((error) => {
        console.error('Error adding document: ', error);
        alert('There was an error submitting your registration. Please try again.');
    });
});
</script>
</html>