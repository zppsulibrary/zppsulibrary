<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/dashboard.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <title>Admin Dashboard</title>
    <!-- SweetAlert2 CDN -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- SheetJS CDN -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
</head>
<body>

    <div class="sidebar">
        <div class="logo">
            <img src="../img/zppuslibrarylogo.png" alt="Logo">
        </div>        
        <h2>Admin Dashboard</h2>
        <ul>
            <li><a href="index.html" id="dashboard-link"><i class="bi bi-speedometer2"></i>Dashboard</a></li>
            <li id="history-link-container">
                <a href="#" id="history-link"  class="active"><i class="bi bi-clock-history"></i>History</a>
                <ul id="history-dropdown" class="dropdown">
                    <li><a href="studentreg.html">Student Registrations</a></li>
                    <li><a href="facultyreg.html"class="active">Faculty Registrations</a></li>
                    <li><a href="adminreg.html">Admin Registrations</a></li>
                    <li><a href="visitorre.html">Visitor Registrations</a></li>
                </ul>
            </li>
            <li><a href="#" id="logout"><i class="bi bi-box-arrow-right"></i>Logout</a></li>
        </ul>
        
    </div>

    <div class="main-content">
        <div class="header">
            <h1>Welcome, Admin</h1>
        </div>
        <div class="card">
            <h3>Faculty Registration Details</h3>
            <input type="text" id="search-faculty-bar" placeholder="Search by name..." />
            <div id="student-card">
                <table>
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Last Name</th>
                            <th>Given Name</th>
                            <th>MI</th>
                            <th>Program</th>
                            <th>Patron Type</th>
                            <th>Submission Date</th>
                            <th>Scan Count</th>
                        </tr>
                    </thead>
                    <tbody id="faculty-table-body">
                        <!-- Data will be inserted here -->
                    </tbody>
                </table>
            </div>
        </div>
        </div>
        
        <style>
            /* Style for the search bar */
input[type="text"] {
    width: 90vh;
    padding: 10px;
    margin-bottom: 10px;
    border: 1px solid #ccc;
    border-radius: 5px;
    font-size: 16px;
    box-sizing: border-box; /* Ensure padding doesn't affect the width */
    transition: border-color 0.3s ease;
}

/* Add focus effect */
input[type="text"]:focus {
    border-color: #007bff; /* Change border color on focus */
    outline: none; /* Remove default focus outline */
}

/* Style for the placeholder text */
input[type="text"]::placeholder {
    color: #888;
    font-style: italic;
}
        </style>

        <script>

            document.getElementById("history-link").addEventListener("click", function(event) {
    event.preventDefault();  // Prevents the default action of the link
    const dropdown = document.getElementById("history-dropdown");
    // Toggle the display style between "block" (visible) and "none" (hidden)
    if (dropdown.style.display === "none" || dropdown.style.display === "") {
        dropdown.style.display = "block";
    } else {
        dropdown.style.display = "none";
    }
});

        </script>
        
        <style>
            .toggle-btn {
                background: none;
                border: none;
                font-size: 20px;
                cursor: pointer;
                position: absolute;
                right: 10px;
            }
        
            .card {
                position: relative;
                padding-right: 40px;
            }
        
            .card div {
                display: block;  /* Show content by default */
            }
        </style>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
    import { getFirestore, collection, query, where, onSnapshot } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAATH_41xPWHK7FWORsbKvFZNjgN0nwzS8",
        authDomain: "zppsulibrary-3f15b.firebaseapp.com",
        projectId: "zppsulibrary-3f15b",
        storageBucket: "zppsulibrary-3f15b.appspot.com",
        messagingSenderId: "693170608073",
        appId: "1:693170608073:web:09d728cfb6489d7675fa18"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Reference to the Firestore collection
    const facultyCollection = collection(db, "registrations");

    // Create a query to fetch only faculty with patron_type = "Faculty"
    const facultyQuery = query(facultyCollection, where("patron-type", "==", "Faculty"));

    let facultyData = []; // Array to store fetched faculty data

    // Fetch data from Firestore and populate the table
    onSnapshot(facultyQuery, (snapshot) => {
        facultyData = snapshot.docs.map(doc => doc.data());
        populateTable(facultyData); // Initially populate the table with all data
    });

   // Function to populate the table with data
function populateTable(data) {
    const tableBody = document.getElementById("faculty-table-body");
    tableBody.innerHTML = ""; // Clear previous table data

    data.forEach((facultyMember, index) => {
        // Combine submissionDate and submissionDates
        const submissionDetails = `
            ${facultyMember.submissionDate || "N/A"}<br>
        `.trim(); // Display submissionDate followed by all submissionDates

        const row = document.createElement("tr");
        row.innerHTML = `
            <td>${index + 1}</td>
            <td>${facultyMember.lastname || "N/A"}</td>
            <td>${facultyMember.givenname || "N/A"}</td>
            <td>${facultyMember.mi || "N/A"}</td>
            <td>${facultyMember.program || "N/A"}</td>
            <td>${facultyMember["patron-type"] || "N/A"}</td>
            <td>${submissionDetails}</td>
            <td>${facultyMember.scanCount || "N/A"}</td>
        `;
        tableBody.appendChild(row);
    });
}


    // Search function
    document.getElementById("search-faculty-bar").addEventListener("input", function(event) {
        const searchTerm = event.target.value.toLowerCase();
        const filteredData = facultyData.filter(facultyMember => {
            const fullName = (facultyMember.lastname + " " + facultyMember.givenname).toLowerCase();
            return fullName.includes(searchTerm); // Filter by full name
        });
        populateTable(filteredData); // Populate table with filtered data
    });

    // Check if user is logged in
    onAuthStateChanged(auth, (user) => {
        if (!user) {
            window.location.href = "login.html";
        }
    });

    // Logout function
    function logout() {
        Swal.fire({
            title: 'Are you sure?',
            text: 'You are about to log out from the dashboard!',
            icon: 'warning',
            showCancelButton: true,
            confirmButtonText: 'Yes, log me out!',
            cancelButtonText: 'Cancel'
        }).then((result) => {
            if (result.isConfirmed) {
                signOut(auth)
                    .then(() => {
                        window.location.href = "login.html";
                    })
                    .catch((error) => {
                        console.error("Error logging out:", error.message);
                    });
            }
        });
    }

    document.getElementById("logout").addEventListener("click", logout);
</script>



</body>
</html>
